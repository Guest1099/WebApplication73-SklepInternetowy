@model EditUserViewModel

@{
    string password = "SDG%$@5423sdgagSDert";
}
 

<div class="headerCe">Edytowanie danych użytkownika</div>

<form method="post" asp-action="Edit" asp-controller="Users" asp-area="Admin" enctype="multipart/form-data">
    <input type="hidden" asp-for="User.Id" value="@Model.User.Id" />


    <div class="db">

        <div class="headerCeUser">Dane logowania</div>

        <h5>@password</h5>

        <div class="row">
            <div class="fieldName">
                <span>Email</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.Email" />
                <span asp-validation-for="User.Email" class="c-red"></span>
                <a asp-action="ChangeEmail"
                   asp-controllers="Users"
                   asp-area="Admin"
                   asp-route-userId="@Model.User.Id">
                    zmień
                </a>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Hasło</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="Password" type="password" />
                <span asp-validation-for="Password" class="c-red"></span>
                <a asp-action="ChangePassword"
                   asp-controllers="Users"
                   asp-area="Admin"
                   asp-route-userId="@Model.User.Id">
                    zmień
                </a>
            </div>
        </div>



        <div class="headerCeUser">Dane osobowe</div>


        <div class="row">
            <div class="fieldName">
                <span>Imię</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Imie" />
                <span asp-validation-for="User.DaneOsobowe.Imie" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Nazwisko</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Nazwisko" />
                <span asp-validation-for="User.DaneOsobowe.Nazwisko" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Ulica</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Ulica" />
                <span asp-validation-for="User.DaneOsobowe.Ulica" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Numer ulicy</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.NumerUlicy" />
                <span asp-validation-for="User.DaneOsobowe.NumerUlicy" class="c-red"></span>
            </div>
        </div>


        <div class="row">
            <div class="fieldName">
                <span>Miejscowość</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Miejscowosc" />
                <span asp-validation-for="User.DaneOsobowe.Miejscowosc" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Kod pocztowy</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.KodPocztowy" />
                <span asp-validation-for="User.DaneOsobowe.KodPocztowy" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Powiat</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Wojewodztwo" />
                <span asp-validation-for="User.DaneOsobowe.Wojewodztwo" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Kraj</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Kraj" />
                <span asp-validation-for="User.DaneOsobowe.Kraj" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Pesel</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Pesel" />
                <span asp-validation-for="User.DaneOsobowe.Pesel" class="c-red"></span>
            </div>
        </div>


        <div class="row">
            <div class="fieldName">
                <span>Data urodzenia</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.DataUrodzenia" />
                <span asp-validation-for="User.DaneOsobowe.DataUrodzenia" class="c-red"></span>
            </div>
        </div>


        <div class="row">
            <div class="fieldName">
                <span>Email</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Email" />
                <span asp-validation-for="User.DaneOsobowe.Email" class="c-red"></span>
            </div>
        </div>

        <div class="row">
            <div class="fieldName">
                <span>Telefon</span>
            </div>
            <div class="fieldEdit">
                <input asp-for="User.DaneOsobowe.Telefon" />
                <span asp-validation-for="User.DaneOsobowe.Telefon" class="c-red"></span>
            </div>
        </div>


        <div class="row">
            <div class="fieldName">
                <span>Płeć</span>
            </div>
            <div class="fieldEdit">
                <select asp-for="User.DaneOsobowe.Plec" asp-items='@new SelectList(Enum.GetValues(typeof(Plec)))' class="selectOption"></select>
                <span asp-validation-for="User.DaneOsobowe.Plec" class="c-red"></span>
            </div>
        </div>


        <div class="row">
            <div class="fieldName">
                <span>Rodzaj osoby</span>
            </div>
            <div class="fieldEdit">
                <select asp-for="User.DaneOsobowe.RodzajOsoby" asp-items='@new SelectList(Enum.GetValues(typeof(RodzajOsoby)))' class="selectOption"></select>
                <span asp-validation-for="User.DaneOsobowe.RodzajOsoby" class="c-red"></span>
            </div>
        </div>




        @*

        <div class="headerCeUser df">Dane firmy (opcjonalnie)</div>

        <div class="row">
        <div class="fieldName">
        <span>Nazwa firmy</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_Nazwa" />
        <span asp-validation-for="User.DaneOsobowe.Firma_Nazwa" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>NIP</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_NIP" />
        <span asp-validation-for="User.DaneOsobowe.Firma_NIP" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>Regon</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_Regon" />
        <span asp-validation-for="User.DaneOsobowe.Firma_Regon" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>Ulica</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_Ulica" />
        <span asp-validation-for="User.DaneOsobowe.Firma_Ulica" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>Numer ulicy</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_NumerUlicy" />
        <span asp-validation-for="User.DaneOsobowe.Firma_NumerUlicy" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>Miejscowość</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_Miejscowosc" />
        <span asp-validation-for="User.DaneOsobowe.Firma_Miejscowosc" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>Kod pocztowy</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_KodPocztowy" />
        <span asp-validation-for="User.DaneOsobowe.Firma_KodPocztowy" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>Powiat</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_Wojewodztwo" />
        <span asp-validation-for="User.DaneOsobowe.Firma_Wojewodztwo" class="c-red"></span>
        </div>
        </div>

        <div class="row">
        <div class="fieldName">
        <span>Kraj</span>
        </div>
        <div class="fieldEdit">
        <input asp-for="User.DaneOsobowe.Firma_Kraj" />
        <span asp-validation-for="User.DaneOsobowe.Firma_Kraj" class="c-red"></span>
        </div>
        </div>
        *@





        @if (Model.PhotosDaneOsobowe != null && Model.PhotosDaneOsobowe.Any())
        {
            <div class="headerCeUser">Zdjęcia</div>
            <div class="row">
                <div class="fieldEdit">
                    @foreach (var photoDaneOsobowe in Model.PhotosDaneOsobowe)
                    {
                        <div class="image w-200px">
                            <partial name="_displayPhoto" model="@photoDaneOsobowe.PhotoData" />
                        </div>
                        
                        <a asp-action="DeletePhotoDaneOsobowe"
                           asp-controller="Users"
                           asp-area="Admin"
                           asp-route-userId="@Model.User.Id"
                           asp-route-photoDaneOsoboweId="@photoDaneOsobowe.PhotoDaneOsoboweId">
                           Usuń zdjęcie
                        </a> 
                    }
                </div>
            </div>



            <div class="headerCeUser">Dodaj kolejne zdjęcia</div>

            <div class="row">
                <div class="fieldName">
                    <span>Dodaj zdjęcie lub zdjęcia</span>
                </div>
                <div class="fieldEdit">
                    <input id="files" asp-for="Files" multiple onchange="saveFiles()" />
                </div>
            </div>
        }
        else
        {
            
            <div class="headerCeUser">Zdjęcia</div>

            <div class="row">
                <div class="fieldName">
                    <span>Dodaj zdjęcie</span>
                </div>
                <div class="fieldEdit">
                    <input id="files" asp-for="Files" multiple onchange="saveFiles()" />
                </div>
            </div>
        }

         








        <div class="headerCeUser">Przypisz role użytkownikowi</div>

        <div class="row">
            <div class="db">
                @foreach (var role in await Context.Roles.ToListAsync())
                {
                    string roleName = role.Name;
                    string roleNamForName = $"{role.Name}ForName";
                    <div class="form-check">
                        <label class="form-check-label" for="@roleNamForName">
                            <input class="form-check-input" type="checkbox" id="@roleNamForName" name="SelectedRoles" value="@roleName" @(Model.SelectedRoles != null && Model.SelectedRoles.Contains(roleName) ? "checked" : "") />
                            @roleName
                        </label>
                    </div>
                }
            </div>
        </div>





    </div>




    <div class="bottom-bar-options">
        <a asp-action="Index" asp-controller="Users" class="form-button-wstecz">Wstecz</a>
        <div>
            <a asp-action="Index" asp-controller="Users" class="form-button-a">Anuluj</a>
            <input type="submit" value="Zapisz" class="form-button" />
        </div>
    </div>
</form>

<br />


@if (!string.IsNullOrEmpty(Model.Result))
{
    <p class="text-danger">
        @Model.Result
    </p>
}



@section Scripts {

    @*Skrypt pozwalający zapamiętać wybrane zdjęcia po przeładowaniu strony*@
    <script>
        var filesInput = document.getElementById('files');
        // Funkcja do zapisywania przesłanych plików w sessionStorage
        function saveFiles() {
            var files = filesInput.files;

            if (files.length > 0) {
                var filesArray = Array.from(files);
                var filesData = filesArray.map(file => {
                    return {
                        name: file.name,
                        type: file.type,
                        size: file.size
                    };
                });

                sessionStorage.setItem('photosDaneOsoboweEdit', JSON.stringify(filesData));
            }
        }

        // Funkcja pobiera dane z sesji do zmiennej po załadowaniu okna
        window.onload = function () {
            var uploadedFilesData = sessionStorage.getItem('photosDaneOsoboweEdit');
            if (uploadedFilesData) {
                var uploadedFiles = JSON.parse(uploadedFilesData); // zamienia tekst na obiekt


                // Utworzenie nowej listy plików
                var newFilesList = new DataTransfer();

                uploadedFiles.forEach(file => {
                    // Utworzenie nowego pliku i dodanie go do listy plików
                    var newFile = new File([], file.name, { type: file.type, size: file.size });
                    newFilesList.items.add(newFile);
                });

                // Przypisanie nowej listy plików do pola input
                filesInput.files = newFilesList.files;
                sessionStorage.clear();
            }
        };
    </script>
} 